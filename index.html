<!DOCTYPE html>
<html lang="tl" class="scroll-smooth" data-theme="auto">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Articles Index</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind dark/light auto theme
    tailwind.config = {
      darkMode: 'media'
    }
  </script>
  <style>
    /* Custom scrollbar for sidebar */
    .sidebar::-webkit-scrollbar { width: 8px; }
    .sidebar::-webkit-scrollbar-thumb { background-color: rgba(100,100,100,0.5); border-radius: 4px; }
  </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">

  <header class="flex items-center justify-between p-4 bg-blue-600 dark:bg-blue-800 text-white">
    <h1 class="text-lg font-bold">Articles</h1>
    <button id="hamburger" class="md:hidden p-2 rounded hover:bg-blue-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
  </header>

  <div class="flex h-[calc(100vh-64px)]">
    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar fixed inset-y-0 left-0 w-64 bg-gray-100 dark:bg-gray-800 overflow-y-auto transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-20">
      <div class="p-4">
        <input id="search" type="text" placeholder="Search articles..." class="w-full p-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 mb-4">
        <div id="list" class="space-y-2"></div>
      </div>
    </nav>

    <!-- Overlay for small screens -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden z-10"></div>

    <!-- Main content -->
    <main class="flex-1 md:ml-64 p-4 overflow-auto">
      <p class="text-gray-500 dark:text-gray-400">Pindutin ang article sa kaliwang listahan para buksan.</p>
    </main>
  </div>

  <script>
    const ARTICLES_PATH = 'articles/';
    const EMBEDDED_MANIFEST = [
      // 'example-article.html',
    ];

    const listEl = document.getElementById('list');
    const searchEl = document.getElementById('search');
    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburger');
    const overlay = document.getElementById('overlay');

    let files = [];

    hamburger.addEventListener('click', ()=>{
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
    });
    overlay.addEventListener('click', ()=>{
      sidebar.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
    });

    searchEl.addEventListener('input', ()=>{
      const query = searchEl.value.toLowerCase();
      Array.from(listEl.children).forEach(div=>{
        const name = div.dataset.filename.toLowerCase();
        div.style.display = name.includes(query)?'block':'none';
      });
    });

    async function loadAll(){
      // Try list.json
      try{
        const res = await fetch(ARTICLES_PATH+'list.json',{cache:'no-store'});
        if(res.ok){
          const data = await res.json();
          if(Array.isArray(data) && data.length){
            files = normalizeList(data);
            renderList();
            return;
          }
        }
      }catch(e){}

      // Try directory listing
      try{
        const res2 = await fetch(ARTICLES_PATH,{cache:'no-store'});
        if(res2.ok){
          const text = await res2.text();
          const parsed = parseDirectoryHtml(text);
          if(parsed.length){
            files = normalizeList(parsed);
            renderList();
            return;
          }
        }
      }catch(e){}

      // Fallback
      files = normalizeList(EMBEDDED_MANIFEST);
      renderList();
    }

    function normalizeList(arr){
      return Array.from(new Set(arr.map(x=>String(x).trim()))).filter(x=>/\.html?$/.test(x)).sort();
    }

    function renderList(){
      listEl.innerHTML='';
      if(!files.length){
        listEl.innerHTML='<p class="text-gray-500 dark:text-gray-400">Walang articles na nahanap.</p>';
        return;
      }
      files.forEach(f=>{
        const div = document.createElement('div');
        div.className='p-2 rounded hover:bg-blue-200 dark:hover:bg-blue-700 cursor-pointer';
        div.textContent = friendlyName(f);
        div.dataset.filename = f;
        div.addEventListener('click', ()=>{ window.location.href = ARTICLES_PATH+f; });
        listEl.appendChild(div);
      });
    }

    function friendlyName(fn){
      const name = fn.replace(/\.html?$/,'').replace(/[-_]/g,' ').replace(/\d{4}[-]?\d{2}[-]?\d{2}/,'').trim();
      return name || fn;
    }

    function parseDirectoryHtml(html){
      try{
        const tmp=document.createElement('div');
        tmp.innerHTML=html;
        const anchors=tmp.querySelectorAll('a');
        const found=[];
        anchors.forEach(a=>{
          const href=a.getAttribute('href');
          if(href && /\.html?$/.test(href)){
            const clean = href.replace(/^(?:\.\/?)+/,'');
            if(clean && clean!='/') found.push(clean);
          }
        });
        return found;
      }catch(e){ return []; }
    }

    loadAll();
  </script>
</body>
</html>
